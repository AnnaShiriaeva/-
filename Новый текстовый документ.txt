&НаСервереБезКонтекста
Процедура ЗагрузитьПрайсЛистПоставщика(ТаблицаПрайсЛиста, ДатаПрайсЛиста, ВидЦеныПродажи)

Запрос = Новый Запрос; 
Запрос.УстановитьПараметр("ТаблицаПрайсЛиста", ТаблицаПрайсЛиста);

Запрос.Текст=
"ВЫБРАТЬ
|   ТаблицаПрайсЛиста.Код КАК Код,
|   ТаблицаПрайсЛиста.Цена КАК Цена,
|   ТаблицаПрайсЛиста.Номенклатура КАК Номенклатура
|ПОМЕСТИТЬ ВТ_ТаблицаПрайсЛиста
|ИЗ
|   &ТаблицаПрайсЛиста КАК ТаблицаПрайсЛиста
|;
|
|////////////////////////////////////////////////////////////////////////////////
|ВЫБРАТЬ
|   Ном.Ссылка КАК Номенклатура,
|   ВТ_ТаблицаПрайсЛиста.Цена КАК Цена,
|   ВТ_ТаблицаПрайсЛиста.Номенклатура КАК Номенклатура1
|ИЗ
|   ВТ_ТаблицаПрайсЛиста КАК ВТ_ТаблицаПрайсЛиста
|       ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.Номенклатура КАК Ном
|       ПО ВТ_ТаблицаПрайсЛиста.Номенклатура = Ном.Наименование";

Рез = Запрос.Выполнить();
Если Рез.Пустой() Тогда
    возврат;
КонецЕсли;

Выборка = Рез.Выбрать();
ЦеныНоменклатуры = РегистрыСведений.ЦеныНоменклатуры;
УстановкаЦен = ЦеныНоменклатуры.СоздатьНаборЗаписей();

Счетчик = 0;
Пока Выборка.Следующий() Цикл  
    
    Строка = УстановкаЦен.Добавить();    
    Строка.Период = ДатаПрайсЛиста;
    Строка.ВидЦены = ВидЦеныПродажи;
    Строка.Номенклатура = Выборка.Номенклатура;
    Строка.Цена = Выборка.Цена;
    Счетчик = Счетчик+1;
КонецЦикла;

Попытка
    УстановкаЦен.Записать();
    СообщениеПользователю = Новый СообщениеПользователю();
    СообщениеПользователю.Текст = "Загружены цены в количестве " + Счетчик;
    СообщениеПользователю.Сообщить();

Исключение

    СообщениеПользователю = Новый СообщениеПользователю();
    СообщениеПользователю.Текст = "Произошла ошибка при загрузке цен!";
    СообщениеПользователю.Сообщить();

КонецПопытки;

Конецпроцедуры
